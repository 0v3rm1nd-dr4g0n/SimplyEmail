jQuery(function($){
	
	var mobileSize = 736,
		desktopSize = 737,
		$menu = $(".nav-primary > .wrap").clone(),
		menuOpened = false;

/*****************************************************************
	Functions
*****************************************************************/

	function resizeMenuItems() {
		var mainMenu = $('.site-container #menu-topnav'),
			menuItem = $('.site-container #menu-topnav > li'),
			numMenuItem = menuItem.length;
					
		menuItem.outerWidth(mainMenu.width()/numMenuItem);
	}
	
	$menu.attr( "id", "menu-mobile" );
	$menu.mmenu({
		//slidingSubmenus: false,
		offCanvas: {
			position: "right",
			//zposition: "next"
		},
		classes: 'mm-veris mm-zoom-panels'

	}).on( "opened.mm", function() {
		menuOpened = true;
	}).on( "closed.mm", function() {
		menuOpened = false;
	});
	$(".menu-btn").on('click', function() {
		if(menuOpened == false) {
			$($menu).trigger("open.mm");
		} else {
			$($menu).trigger("close.mm");
		}
	});


	$( ".tabs-nav" ).parent().tabs();
	
	var tab = $('ul.tabs-nav li'),
		tabParent = $('ul.tabs-nav'),
		numTabs = tab.length;
		
	//tab.width(100/numTabs+'%');
	
	$('.ui-tabs-anchor').on('click', function(){
		equalheight('.image-grid .grid-block');
	});
	
	//tab.height(tabParent.height());
	
/*
	$("#footer-logos").owlCarousel({
		nav: true,
		dots: false,
		navText: ['',''],
		responsive : {
		    0 : {
				items: 2,
				slideBy: 2
		    },
		    568 : {
				items: 3,
				slideBy: 3
		    },
		    737 : {
				items: 4,
				slideBy: 4
		    },
		    881 : {
				items: 5,
				slideBy: 5
		    }
		}
	});
*/
	var footerSlider = $("#footer-logos");

	if(footerSlider.length > 0) {

		footerSlider.slick({
			slidesToShow: 5,
			slidesToScroll: 5,
			dots: false,
			arrows: true,
			responsive: [
			    {
					breakpoint: 881,
					settings: {
						slidesToShow: 4,
						slidesToScroll: 4,
					}
				},
				{
					breakpoint: 737,
					settings: {
						slidesToShow: 3,
						slidesToScroll: 3,
					}
				},
				{
					breakpoint: 568,
					settings: {
						slidesToShow: 2,
						slidesToScroll: 2,
					}
				}
			]
		});
	}
	
	var hero = $("#atd-team-sliders");
	
	if(hero.length > 0) {
		
		var slider = $('.team-slider'),
			sliderNav = $('.team-nav'),
			currSlide = 0,
			hasHash = false,
			memberHash = window.location.hash,
			memberClass = memberHash.replace('#', '.');
			
		if(memberHash != '' && $(memberClass).length > 0) {
			
			hasHash = true,
			currSlide = $(memberClass).index();
		}

		slider.slick({
			fade: true,
			slidesToScroll: 1,
			slidesToShow: 1,
			autoplay: true,
			autoplay: (hasHash == true ) ? false : true,
			autoplaySpeed: 11000,
			pauseOnHover: true,
			dots: false,
			arrows: false,
			adaptiveHeight: true,
			draggable: false,
			asNavFor: '.team-nav',
			initialSlide: currSlide
		});

		$('.team-nav').slick({
			slidesToShow: 5,
			slidesToScroll: 1,
			asNavFor: '.team-slider',
			dots: true,
	        centerMode: true,
			centerPadding: '50px',
			focusOnSelect: true,
			dots: false,
			arrows: false,
			adaptiveHeight: true,
			initialSlide: currSlide,
			responsive: [
			    {
					breakpoint: 880,
					settings: {
						slidesToShow: 3,
				        centerMode: true,
						centerPadding: '50px'
					}
				},
				{
					breakpoint: 480,
					settings: {
				        slidesToShow: 1,
				        centerMode: true,
						centerPadding: '100px'
					}
				},
				{
					breakpoint: 400,
					settings: {
				        slidesToShow: 1,
				        centerMode: true,
						centerPadding: '80px'
					}
				},
				{
					breakpoint: 330,
					settings: {
				        slidesToShow: 1,
				        centerMode: true,
						centerPadding: '40px'
					}
				}
			]
		});
	}
	
	$("[href*='www.youtube.com/embed']").fancybox({
		width : 16/9. * 480,
		height : 480,
		autoCenter	: true,
		aspectRatio : true,
		autoSize	: true,
		closeClick	: false,
		openEffect	: 'fade',
		closeEffect	: 'fade',
		closeBtn	: true,
		helpers : {
			media : {}
		}
	});
	
	function parallaxInit(){
		var nVer = navigator.appVersion,
			nAgt = navigator.userAgent,
			nameOffset,verOffset,ix;
	
		// Set variable of 'Safari' to Mobile Safari browsers
		if(navigator.platform == 'iPhone' || navigator.platform == 'iPod' || navigator.platform == 'iPad'){
			if ((verOffset=nAgt.indexOf('Safari'))!=-1) {
				var mobileSafari = 'Safari';
			}
		}
		
		var vertOffset = -1000;
/*
		if ($(window).width() <= 490){
			vertOffset = 50;
		} else if ($(window).width() <= 736){
			vertOffset = -150;
		} else if ($(window).width() <= 1200) {
			vertOffset = -500;
		}
*/
		
		// Set height of Mobile Menu to not remove the 60px on Mobile Safari
		if (mobileSafari == 'Safari') {
			$('html').addClass('ios');
		} else {
			if ($(window).width() > 500) {
				$(function(){
					$.stellar({
						horizontalScrolling: false,
//						verticalOffset: vertOffset
					});
				});
			}
		};
	}
	
	function fitTextInit(){
		$('.page-header-image h1').fitText(1.5, { maxFontSize: '55px', minFontSize: '35px'}).animate({
			'opacity' : 1,
		},1000);
	}



/* Thanks to CSS Tricks for pointing out this bit of jQuery
http://css-tricks.com/equal-height-blocks-in-rows/
It's been modified into a function called at page load and then each time the page is resized. One large modification was to remove the set height before each new calculation. */

	equalheight = function(container){
	
	var currentTallest = 0,
	     currentRowStart = 0,
	     rowDivs = new Array(),
	     $el,
	     topPosition = 0;
	 $(container).each(function() {
	
	   $el = $(this);
	   $($el).height('auto')
	   topPostion = $el.position().top;
	
	   if (currentRowStart != topPostion) {
	     for (currentDiv = 0 ; currentDiv < rowDivs.length ; currentDiv++) {
	       rowDivs[currentDiv].height(currentTallest);
	     }
	     rowDivs.length = 0; // empty the array
	     currentRowStart = topPostion;
	     currentTallest = $el.height();
	     rowDivs.push($el);
	   } else {
	     rowDivs.push($el);
	     currentTallest = (currentTallest < $el.height()) ? ($el.height()) : (currentTallest);
	  }
	   for (currentDiv = 0 ; currentDiv < rowDivs.length ; currentDiv++) {
	     rowDivs[currentDiv].height(currentTallest);
	   }
	 });
}

	$(window).load(function(){
		equalheight('.image-grid .grid-block, .co-grid-container .co-grid-block');
	});


/*************************************************************************************
	Call functions that do not need to be called on resize
*************************************************************************************/
	//menuBtn();
	parallaxInit();
	fitTextInit();



/*************************************************************************************
	Call Functions that do need to be called on resize
*************************************************************************************/
	$(window).resize(function() {
		resizeMenuItems();
		equalheight('.image-grid .grid-block, .co-grid-container .co-grid-block');
		if($(window).width() >= desktopSize && menuOpened == true ) {
			$($menu).trigger("close.mm");
		}
	}).resize();


/*************************************************************************************
	Call Functions that do need to be called after browser is finished resizing
*************************************************************************************/

	var waitForFinalEvent = (function () {
	var timers = {};
	
	return function (callback, ms, uniqueId) {
		if (!uniqueId) {
			uniqueId = "Do not call this twice without a uniqueId";
		}
	    if (timers[uniqueId]) {
			clearTimeout (timers[uniqueId]);
	    }
	    timers[uniqueId] = setTimeout(callback, ms);
		};
	})();
	
/* 	var winWidth = $(window).width(); */

	$(window).resize(function() {
		waitForFinalEvent(function(){
			equalheight('.image-grid .grid-block, .co-grid-container .co-grid-block');
			var nVer = navigator.appVersion,
				nAgt = navigator.userAgent,
				nameOffset,verOffset,ix;
		
			// Set variable of 'Safari' to Mobile Safari browsers
			if(navigator.platform == 'iPhone' || navigator.platform == 'iPod' || navigator.platform == 'iPad'){
				if ((verOffset=nAgt.indexOf('Safari'))!=-1) {
					var mobileSafari = 'Safari';
				}
			}
						
			// Set height of Mobile Menu to not remove the 60px on Mobile Safari
			if (mobileSafari == 'Safari') {
				$('html').addClass('ios');
			} else {
				if ($(window).width() > 500) {
					$(function(){
						$.stellar('refresh');
					});
				}
			};
	    }, 500, "some unique string");
	}).resize();

});